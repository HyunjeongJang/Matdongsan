<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="adminMapper">

    <resultMap id="AdminResultSet" type="admin">
        <result column="REPORT_NO" property="reportNo"/>
        <result column="FREE_BNO" property="fNo"/>
        <result column="NICKNAME" property="nickName"/>
        <result column="EMAIL" property="email"/>
        <result column="BOARD_WRITER" property="boardWriter"/>
        <result column="MEMBER_NO" property="memberNo"/>
        <result column="STATUS" property="status"/>
        <result column="MEMBER_NAME" property="memberName"/>
        <result column="REPORT_USER_NO" property="reportUserNo"/>
        <result column="REPORT_CONTENT" property="reportContent"/>
        <result column="REPORT_TYPE" property="reportType"/>

    </resultMap>

    <select id="userList" resultMap="AdminResultSet">
        select
            M.MEMBER_NO,
            NICKNAME,
            EMAIL,
            M.STATUS,
            F.FREE_BNO
        FROM MEMBER M
        JOIN FREE_BOARD F ON(M.MEMBER_NO = F.MEMBER_NO)
        ORDER BY MEMBER_NO

    </select>

    <select id="reportList" resultMap="AdminResultSet" parameterType="int">
        SELECT
            REPORT_NO,
            REPORT_CONTENT,
            REPORT_TYPE,
            R.FREE_BNO,
            F.FREE_BNO,
            M.EMAIL,
            F.BOARD_WRITER
        FROM REPORT R
                 LEFT OUTER JOIN MEMBER M ON (R.MEMBER_NO= M.MEMBER_NO)
                 LEFT OUTER JOIN FREE_BOARD F ON(F.FREE_BNO = R.FREE_BNO)
            <!--AND
            <choose>
                <when test="stop == 'three'">
                    M.STATUS = 'A'
                    BETWEEN TO_DATE('SYSDATE', 'YYYY-MM-DD')
                    AND TO_DATE('SYSDATE + 3', 'YYYY-MM-DD')
                </when>
                <when test="stop == 'seven'">
                    M.STATUS = 'B'
                    BETWEEN TO_DATE('SYSDATE', 'YYYY-MM-DD')
                    AND TO_DATE('SYSDATE + 7', 'YYYY-MM-DD')
                </when>
                <when test="stop == 'infinity'">
                    M.STATUS = 'C'
                </when>
            </choose>-->

    </select>

    <select id="uListCount" resultType="int">
        SELECT COUNT(*)
        FROM MEMBER
    </select>

    <select id="rListCount" resultType="int">
        SELECT COUNT(*)
        FROM REPORT
    </select>
    <update id="deleteQna" parameterType="int">
        UPDATE QNA_BOARD
        SET STATUS = 'N'
        WHERE QNA_BNO in (
            SELECT QNA_BNO FROM qna_board
            START WITH QNA_BNO = #{fNo}
            CONNECT BY PRIOR QNA_BNO = P_BNO
        )
    </update>

    <update id="deleteFree" parameterType="int">
        UPDATE FREE_BOARD
        SET STATUS = 'N'
        WHERE FREE_BNO = #{fNo}
    </update>





</mapper>